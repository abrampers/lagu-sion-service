#+title: Architecture Decision Record for =lagu-sion-service=

* Project Description

** In Scope

** Out of Scope

** Design / Wireframes

* Accepted Decisions

* System Design
- How to present data (will be read heavy)
  - search
  - get lyrics
- How to input data
  - CSV?
- How to modify data

* Domain Data Structures

* APIs

** API Architecture
- REST
- GRPC
- GraphQL

** API definitions

* Storage

** DB Stack
- MongoDB
- Postgresql
- Redis

** DB Schema

* Monitoring
- Grafana + Loki?
- NewRelic / Appdynamics

* Project Structure
[[https://github.com/golang-standards/project-layout][golang-standards/project-layout]]

* Libraries

** Router
[[https://www.nicolasmerouze.com/guide-routers-golang][Golang router comparison]]

- [[http://www.gorillatoolkit.org/pkg/mux][gorilla/mux]]
- [[https://github.com/julienschmidt/httprouter][httprouter]]
- [[https://github.com/bmizerany/pat][pat]]
- [[https://github.com/gin-gonic/gin][gin]]

** Testing

** Database Client

* CI/CD Platform

Assumptions:
- Repo is public
- Empty means unlimited

| platform       | price | limits (min/month) | concurrent jobs | manual deployment? | Supported platform        |
|----------------+-------+--------------------+-----------------+--------------------+---------------------------|
| Gitlab CI      | free  |                    |                 | yes                | gitlab                    |
| GitHub Actions | free  |                    |                 | no                 | github                    |
| Travis CI      | free  |                    |             200 |                    | github, bitbucket         |
| CircleCI       | free  |              40000 |               4 | yes                | github, bitbucket         |
| Jenkins        | free  |                    |                 | yes                | github, gitlab, bitbucket |

** Gitlab CI

** GitHub Actions

** Travis CI

Private / Open Source: unlimited (need to recheck)

Currently is migrating from travis-ci.org to travis-ci.com. This might be problematic when implementing

As per [[https://docs.travis-ci.com/user/deployment/][Deployment and uploads]]: No manual deployment supported

** CircleCI

OSS: 100k credits / week
[[https://circleci.com/docs/2.0/oss/][Open source limits]]

Docker small (1 vCPU, 2 GB): 5 credit/min
Docker Medium (2 vCPU, 4 GB): 10 credit/min

Linux VM Medium (2 vCPU, 7.5 GB): 10 credit/min

Try whether docker small is cheaper to use than linux vm medium

- Telegram notification [[https://circleci.com/developer/orbs/orb/woltsu/telegram][woltsu/telegram]]
- [[https://circleci.com/docs/2.0/deployment-integrations/][Deployoment configuration]]
- [[https://circleci.com/blog/optimizing-open-source-projects-on-circleci/][Storing build artifacts]]

[[https://circleci.com/docs/2.0/circleci-images/#pre-installed-tools][Pre built]] Docker image for [[https://circleci.com/developer/images/image/cimg/go][golang]] is provided. [[https://circleci.com/docs/2.0/custom-images/][Custom built]] Docker images are also possible.

*** TODO Find artifacts storage limits
* Infrastructure
** TODO Infrastructure as a Code
- Chef
- Ansible
- Terraform
** TODO Cloud service
- AWS
- Azure
*** TODO What type of infrastructure
- Function as a service
- Virtual Private Server
* Misc Notes
- use some kind of docker compose to run service locally -> /deployments/docker-compose-local
- put server bootstrapping in this repo as well -> /deployments/bootstrap-server

